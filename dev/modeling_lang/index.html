<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Modeling language Â· Jaynes.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Jaynes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Jaynes.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li class="is-active"><a class="tocitem" href>Modeling language</a><ul class="internal"><li><a class="tocitem" href="#Specialized-call-sites"><span>Specialized call sites</span></a></li></ul></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../concepts/">Concepts</a></li><li><a class="tocitem" href="../architecture/">Architecture</a></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../library_api/sites/">Traces, choices, and call sites</a></li><li><a class="tocitem" href="../library_api/contexts/">Execution contexts</a></li><li><a class="tocitem" href="../library_api/selection_interface/">Selection interface</a></li><li><input class="collapse-toggle" id="menuitem-6-4" type="checkbox"/><label class="tocitem" for="menuitem-6-4"><span class="docs-label">Inference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../inference/is/">Importance sampling</a></li><li><a class="tocitem" href="../inference/mh/">Metropolis-Hastings</a></li><li><a class="tocitem" href="../inference/pf/">Particle filtering</a></li><li><a class="tocitem" href="../inference/vi/">Automatic differentiation variational inference</a></li></ul></li><li><a class="tocitem" href="../library_api/fmi/">Foreign model interface</a></li><li><a class="tocitem" href="../library_api/diff_prog/">Differentiable programming</a></li></ul></li><li><a class="tocitem" href="../benchmarks/">Benchmarks</a></li><li><a class="tocitem" href="../related_work/">Related work</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Modeling language</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Modeling language</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/femtomc/Jaynes.jl/blob/master/docs/src/modeling_lang.md" title="Edit on GitHub"><span class="docs-icon fab">ï‚›</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p>The modeling language for Jaynes is ... Julia! We don&#39;t require the use of macros to specify probabilistic models, because the tracer tracks code using introspection at the level of lowered (and IR) code.</p><pre><code class="language-julia">function bayeslinreg(N::Int)
    Ïƒ = rand(:Ïƒ, InverseGamma(2, 3))
    Î² = rand(:Î², Normal(0.0, 1.0))
    y = Vector{Float64}(undef, N)
    for i in 1:N
        y[i] = rand(:y =&gt; x, Normal(Î²*x, Ïƒ))
    end
    return y
end</code></pre><p>However, this doesn&#39;t give you free reign to write anything with <code>rand</code> calls and expect it to compile to a valid probabilistic program. Here we outline a number of restrictions (originally formalized in <a href="https://www.gen.dev/dev/ref/gfi/#Mathematical-concepts-1">Gen</a>) which are required to allow inference to stay strictly Bayesian.</p><ol><li><p>For branches with address spaces which intersect, the addresses in the intersection <em>must</em> have distributions with the same base measure. This means you cannot swap continuous for discrete or vice versa depending on which branch you&#39;re on.</p></li><li><p>Mutable state does not interact well with iterative inference (e.g. MCMC). Additionally, be careful about the support of your distributions in this regard. If you&#39;re going to use mutable state in your programs, use <code>rand</code> calls in a lightweight manner - only condition on distributions with constant support and be careful about MCMC.</p></li></ol><h2 id="Specialized-call-sites"><a class="docs-heading-anchor" href="#Specialized-call-sites">Specialized call sites</a><a id="Specialized-call-sites-1"></a><a class="docs-heading-anchor-permalink" href="#Specialized-call-sites" title="Permalink"></a></h2><p>Jaynes also offers a set of primitive language features for creating <em>specialized call sites</em> which are similar to the combinators of <a href="https://www.gen.dev/dev/ref/combinators/#Generative-Function-Combinators-1">Gen</a>. These special features can be activated by a special set of calls (below, <code>markov</code> and <code>plate</code>).</p><pre><code class="language-julia">using Jaynes

function bar(m, n)
    x = rand(:x, Normal(m, 1.0))
    q = rand(:q, Normal(x, 5.0))
    z = rand(:z, Normal(n + q, 3.0))
    return q, z
end

function foo()
    x = markov(:x, bar, 10, 0.3, 3.0)
    y = plate(:y, bar, x)
    return y
end

ret, cl = simulate(foo)
display(cl.trace; show_values = true)</code></pre><p>Here, the <code>markov</code> and <code>plate</code> calls provide explicit knowledge to the tracer that the generation of randomness conforms to a computation pattern which can be vectorized. This allows the tracer to construct an efficient <code>VectorizedCallSite</code> which allows more efficient updates/regenerations than a &quot;black-box&quot; <code>CallSite</code> where the dependency information may not be known. This is a simple way for the user to increase the efficiency of inference algorithms, by informing the tracer of information which it can&#39;t derive on its own (at least for now ðŸ˜º).</p><p><code>markov</code> requires that the user provide a function <code>f</code> with</p><div>\[f: (X, Y) \rightarrow (X, Y)\]</div><p>as well as a first argument which denotes the number of fold operations to compute (in the example above, <code>10</code>). <code>markov</code> will then iteratively compute the function, passing the return value as arguments to the next computation (from left to right).</p><p><code>plate</code> does not place requirements on the function <code>f</code> (other than the implicit requirements for valid programs, as described above) but does require that the arguments be a <code>Vector</code> with each element matching the signature of <code>f</code>. <code>plate</code> then iteratively applies the function as a kernel for each element in the argument vector (similar to the functional <code>map</code> operation).</p><p>In the future, a number of other specialized call sites are planned. The fallback is always black-box tracing, but if you provide the tracer with more information about the dependency structure of your probabilistic program, it can utilize this to accelerate iterative inference algorithms. One interesting research direction is the automatic discovery of these patterns in programs: if you&#39;re interested in this, please contribute to the <a href="https://github.com/femtomc/Jaynes.jl/issues/31">open issue about automatic structure discovery</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">Â« Introduction</a><a class="docs-footer-nextpage" href="../examples/">Examples Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 27 July 2020 23:29">Monday 27 July 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
