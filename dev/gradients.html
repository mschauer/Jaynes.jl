<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Differentiable programming · Jaynes.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/favicon.ico" rel="icon" type="image/x-icon"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="Jaynes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Jaynes.jl</span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><a class="tocitem" href="trace_types.html">Trace types</a></li><li><a class="tocitem" href="architecture.html">Implementation architecture</a></li><li><a class="tocitem" href="contextual_DSLs.html">Contextual domain-specific languages</a></li><li class="is-active"><a class="tocitem" href="gradients.html">Differentiable programming</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="gradients.html">Differentiable programming</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="gradients.html">Differentiable programming</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/femtomc/Jaynes.jl/blob/master/docs/src/gradients.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p>Jaynes contains a number of components which utilize or allow for <em>differentiable programming</em>. At the highest level, learnable parameters can be declared by passing literals into <code>rand</code> calls. These declarations are not used in contexts parametrized by inference and tracing metadata, but have a special interpretation in contexts parametrized by <code>GradientMeta</code> instances.</p><h3 id="Learnable-parameters-1"><a class="docs-heading-anchor" href="#Learnable-parameters-1">Learnable parameters</a><a class="docs-heading-anchor-permalink" href="#Learnable-parameters-1" title="Permalink"></a></h3><pre><code class="language-julia"># Literals are tracked as trainable.
x = rand(:x, 10.0)
t = rand(:t, 7.0)</code></pre><p>This informally represents a sort of delta distribution with initial parameter equal to the literal. You might imagine constructing a program <code>foo1</code> with learnable parameters:</p><pre><code class="language-julia">function foo1()
    # Literals are tracked as trainable.
    x = rand(:x, 10.0)
    t = rand(:t, 7.0)
    cat_p = rand(:cat_p, 0.2)

    # Rand calls on distributions also get tracked and the dependency graph is created.
    y = rand(:y, Normal, (x, 1.0))
    z = rand(:z, Normal, (t, 3.0))
    cat = rand(:cat, Categorical, ([cat_p, 1 - cat_p], ))
    for i in 1:10
        if cat == 1
            q = rand(:q =&gt; i, Normal, (5.0, 1.0))
        else
            q = rand(:q =&gt; i, Normal, (8.0, 1.0))
        end
    end
    return z
end</code></pre><p>The natural objective is the <code>logpdf</code> of a trace over the execution of this program. We might generate traces from another program, and perform gradient-based learning to maximize the <code>logpdf</code> of the model program with learnable parameters.</p><pre><code class="language-julia">function foo2()
    x = rand(:x, 1.0)
    y = rand(:y, Normal, (x, 1.0))
    z = rand(:z, Normal, (x + 10, 13.0))
    cat = rand(:cat, Categorical, ([0.5, 0.5],))
    for i in 1:10
        if cat == 1
            q = rand(:q =&gt; i, Normal, (5.0, 1.0))
        else
            q = rand(:q =&gt; i, Normal, (10.0, 1.0))
        end
    end
    return z
end</code></pre><p>We can generate a batch of traces from the target <code>foo2</code>:</p><pre><code class="language-julia">ctx, trs, _, _ = importance_sampling(foo2, (), 10000)</code></pre><p>Jaynes supports <a href="https://github.com/FluxML/Flux.jl">Flux</a>-style learning APIs:</p><pre><code class="language-julia">trained_ctx, losses = train!(ADAM(), foo1, (), trs)
plt = plot(losses, legend=:false)
display(plt)</code></pre><p><img src="assets/gradients_loss.png" alt="LogPDF loss over training set."/></p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Despite the fact that this seems like a <em>batch</em> training step with batch <code>trs</code> - the optimization is performed on a trace by trace basis, because traces can have different shapes. </p><p>There are methodologies to allow for vectorized batching of traces (i.e. when the modeling language is restricted, so that the call graph of the program is constant over traces) but they are not yet enabled in the library.</p></div></div><p>Here, after training, the resultant parameter values are stored in <code>trained_ctx.metadata.trainable</code> which is a map from <code>Address</code> to values. These values can be extracted and used in other contexts - the contextual execution of any program which includes addressed <code>rand</code> calls with literals will check the context for <code>trainable</code> metadata and return if the address matches a key.</p><h3 id="Inference-compilation-1"><a class="docs-heading-anchor" href="#Inference-compilation-1">Inference compilation</a><a class="docs-heading-anchor-permalink" href="#Inference-compilation-1" title="Permalink"></a></h3><p>One powerful inference feature allowed by the differentiable programming capabilities available in Julia is the creation of <em>inference compilers</em> automatically on a program by program basis. Inference compilers are neural network architectures which are trained to produce proposal distributions for sequential sampling-based inference engines.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="contextual_DSLs.html">« Contextual domain-specific languages</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 22 June 2020 01:08">Monday 22 June 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
